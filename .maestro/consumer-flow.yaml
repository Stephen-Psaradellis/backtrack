# Consumer Flow
# Tests browsing posts and matching

appId: com.loveledger.app
name: "Consumer - Browse and Match Flow"
tags:
  - full
  - consumer

---

# Launch and login first
- launchApp

# Login if needed
- runFlow:
    when:
      visible: "Welcome Back"
    file: auth-login.yaml

# Navigate to discover/browse posts
- tapOn:
    id: "discover-tab"
    optional: true
- tapOn:
    text: "Discover"
    optional: true

# Wait for discover screen
- extendedWaitUntil:
    visible:
      id: "discover-screen"
    timeout: 5000
    optional: true

- takeScreenshot: discover_screen

# Browse posts - scroll through list
- scroll:
    direction: DOWN

- takeScreenshot: scrolled_posts

# Tap on a post to view details
- tapOn:
    id: "post-card"
    index: 0
    optional: true

- runFlow:
    when:
      visible:
        id: "post-detail-screen"
    commands:
      - takeScreenshot: post_detail
      # Look for match button
      - tapOn:
          id: "match-button"
          optional: true
      - tapOn:
          text: "This is me"
          optional: true

# Check for match confirmation or chat
- runFlow:
    when:
      visible:
        text: "Match"
    commands:
      - takeScreenshot: match_confirmation
      - tapOn:
          text: "Send Message"
          optional: true

# Verify chat screen if match was successful
- runFlow:
    when:
      visible:
        id: "chat-screen"
    commands:
      - takeScreenshot: chat_screen
      - tapOn:
          id: "message-input"
      - inputText: "Hi! I think we saw each other at the coffee shop!"
      - hideKeyboard
      - tapOn:
          id: "send-message-button"
      - takeScreenshot: message_sent

# Navigate back to home
- tapOn:
    id: "home-tab"
    optional: true
- tapOn:
    text: "Home"
    optional: true

- takeScreenshot: flow_complete
