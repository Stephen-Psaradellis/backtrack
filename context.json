{
  "files_to_modify": {
    "main": [
      "lib/supabase.ts",
      "lib/supabase/client.ts",
      "lib/supabase/server.ts",
      "lib/supabase/middleware.ts",
      "app/layout.tsx"
    ]
  },
  "files_to_create": {
    "main": [
      "lib/dev/index.ts",
      "lib/dev/mock-supabase.ts",
      "lib/dev/mock-google-maps.ts",
      "components/DevModeBanner.tsx"
    ]
  },
  "files_to_reference": [
    "__tests__/mocks/supabase.ts",
    "__tests__/mocks/index.ts",
    "types/database.ts",
    "types/avatar.ts"
  ],
  "patterns": {
    "mock_supabase_pattern": "createMockQueryBuilder supports chaining (select, eq, single, etc.) and returns {data, error} structure",
    "auth_pattern": "createMockAuth returns mock user/session with signIn/signUp/signOut methods",
    "storage_pattern": "createMockStorage provides upload/download/getPublicUrl with mock file paths",
    "environment_detection": "Use process.env.NODE_ENV to distinguish dev from production"
  },
  "existing_implementations": {
    "description": "Comprehensive test mocks exist in __tests__/mocks/supabase.ts with 500+ lines covering all Supabase operations",
    "relevant_files": [
      "__tests__/mocks/supabase.ts",
      "lib/supabase/client.ts",
      "lib/supabase/server.ts",
      "lib/supabase/middleware.ts"
    ]
  },
  "key_observations": [
    "Test mocks use Jest (jest.fn()) - need to adapt for runtime use",
    "Four Supabase client files need conditional mock injection",
    "Middleware calls supabase.auth.getUser() - must handle gracefully",
    "React Native client uses AsyncStorage for session persistence",
    "MapView.tsx uses react-native-maps, not @vis.gl/react-google-maps"
  ]
}
